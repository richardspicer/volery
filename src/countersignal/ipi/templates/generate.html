{% extends "layout.html" %}
{% block title %}Generate - CounterSignal IPI{% endblock %}
{% block content %}
<div class="page-header">
  <h2>Generate Payloads</h2>
  <p>Create canary documents with hidden payloads</p>
</div>

<div class="card">
  <form hx-post="/api/generate" hx-target="#gen-result" hx-swap="innerHTML">
    <div class="form-row">
      <div class="form-group">
        <label for="callback_url">Callback URL</label>
        <input type="text" id="callback_url" name="callback_url"
               class="form-control" value="http://localhost:8080" required>
      </div>
      <div class="form-group">
        <label>Output Directory</label>
        <input type="text" class="form-control" value="./payloads/" disabled
               title="Fixed output directory">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="format">Format</label>
        <select id="format" name="format" class="form-control"
                hx-get="/api/techniques" hx-target="#technique"
                hx-trigger="change" hx-include="this">
          {% for f in formats %}
          <option value="{{ f }}">{{ f }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="technique">Technique</label>
        <select id="technique" name="technique" class="form-control">
          <option value="all">all</option>
          {% for t in techniques %}
          <option value="{{ t }}">{{ t }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="payload_style">Payload Style</label>
        <select id="payload_style" name="payload_style" class="form-control">
          {% for s in styles %}
          <option value="{{ s }}"{% if s == 'citation' %} selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="payload_type">Payload Type</label>
        <select id="payload_type" name="payload_type" class="form-control">
          {% for pt in payload_types %}
          <option value="{{ pt }}">{{ pt }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="base_name">Base Filename</label>
        <input type="text" id="base_name" name="base_name"
               class="form-control" value="report">
      </div>
      <div class="form-group">
        <label for="seed">Seed (optional)</label>
        <input type="number" id="seed" name="seed"
               class="form-control" placeholder="Leave empty for random">
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Generate Payloads</button>
    </div>
  </form>
</div>

<div id="gen-result"></div>
{% endblock %}
