{% extends "layout.html" %}
{% block title %}Campaign {{ campaign.uuid[:8] }} - CounterSignal IPI{% endblock %}
{% block content %}
<div class="page-header">
  <h2>Campaign Detail</h2>
  <p><a href="/ui/campaigns">&larr; All campaigns</a></p>
</div>

<div class="card">
  <h3>Campaign Info</h3>
  <dl class="kv-grid">
    <dt>UUID</dt>
    <dd class="mono">{{ campaign.uuid }}</dd>
    <dt>Token</dt>
    <dd class="mono">{{ campaign.token[:12] }}...</dd>
    <dt>Filename</dt>
    <dd>{{ campaign.filename }}</dd>
    <dt>Format</dt>
    <dd><span class="badge badge-format">{{ campaign.format }}</span></dd>
    <dt>Technique</dt>
    <dd><span class="badge badge-technique">{{ campaign.technique.value }}</span></dd>
    <dt>Payload Style</dt>
    <dd>{{ campaign.payload_style.value }}</dd>
    <dt>Payload Type</dt>
    <dd>{{ campaign.payload_type.value }}</dd>
    <dt>Callback URL</dt>
    <dd class="mono text-sm">{{ campaign.callback_url }}</dd>
    <dt>Created</dt>
    <dd>{{ campaign.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}</dd>
  </dl>
</div>

<div class="card">
  <h3>Hits ({{ hits|length }})</h3>
  {% if hits %}
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Confidence</th>
        <th>Token</th>
        <th>Source IP</th>
        <th>User-Agent</th>
        <th>Data</th>
      </tr>
    </thead>
    <tbody>
    {% for h in hits %}
      <tr>
        <td class="mono text-sm">{{ h.timestamp.strftime('%H:%M:%S') }}</td>
        <td><span class="badge badge-{{ h.confidence.value }}">{{ h.confidence.value }}</span></td>
        <td>{% if h.token_valid %}<span class="token-valid">valid</span>{% else %}<span class="token-invalid">missing</span>{% endif %}</td>
        <td class="mono text-sm">{{ h.source_ip }}</td>
        <td class="truncate text-sm">{{ h.user_agent[:50] }}</td>
        <td>{% if h.body %}<span class="text-sm" style="color:var(--conf-medium)">{{ h.body[:80] }}{% if h.body|length > 80 %}...{% endif %}</span>{% else %}<span class="text-dim">-</span>{% endif %}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty"><p>No hits received for this campaign yet.</p></div>
  {% endif %}
</div>
{% endblock %}
